<!doctype html>
<html>
<head>
  <title><%= htmlWebpackPlugin.options.title %></title>
</head>
<style>

</style>

<body>
  <div class="pic"></div>
<!--     <input id="file" type="file" name="file">
  <div id="fileBox" onclick="file.click()">
      <i>
          +
      </i>
  </div>
  <input type="button" value="上传" id="btn">
  <br> -->
  <input id="dirFile" type="file" name="file" webkitdirectory directory>
  <div id="dirImgBox">
      <div id="dirFileBox"  onclick="dirFile.click()">
          <i>
              +
          </i>
      </div>
  </div>
  <!-- <input type="button" value="上传" id="btn1"> -->
  <script>
      var fileBox = document.querySelector("#fileBox");
      var colspanCount = 0;
      var imgList = [];
      // file.onchange = function () {
          // /*
          //  本地预览
          //   var reader = new FileReader()
          //   reader.onload = function(e){
              //  e.target.result 什么格式取决于读取方式
              //  img = new Image();
              //  img.src = e.target.result; 
              //  img.width = 200
              //  document.body.appendChild(img)
          //   }
          //   reader.readAsDataURL(this.files[0]); //读取文件,以url格式,
          //   reader.readAsText(this.files[0]) //读取文件,以文本格式
          // */

          // 本地预览
          // var imgHeight = 0;
          // var imgWidth = 0;
          // img = new Image();
          // img.src = window.URL.createObjectURL(this.files[0]); //创建路径对象
          // img.width = 200;
          // for (var i = fileBox.children.length; i > 0; i--) {
              // fileBox.children[i - 1].remove();
          // }
          // img.onload = function () {
              // fileBox.style.width = img.width + "px";
              // fileBox.style.height = img.height + "px";
              // fileBox.classList.add("hasImg");
              // console.log(fileBox.children)
              // window.URL.revokeObjectURL(this.src); //删除路径对象
          // }
          // fileBox.appendChild(img)
      // }
      // btn.onclick = function () {
          // var XHR = new XMLHttpRequest();
          // var formData = new FormData();
          // formData.appendChild("img", file.files[0])
          // XHR.open("POST", "http://baidu.com", true);
          // XHR.send(formData);
          // XHR.onreadystatechange = function () {
              // if (XHR.status == 200 && XHR.readyState == 4) {
                  // console.log(xhr.responseText);
              // } else {
                  // console.log(xhr.responseText);
              // }
          // }
      // }
      dirFile.onchange = function (e) {
          var imgHeightList = [];
          var imgWidth = 200;
          var imgLoadIndex = 0;
          var dirImgBoxWidth = dirImgBox.offsetWidth;
          colspanCount = parseInt(dirImgBoxWidth/ (imgWidth + 22));
          (new Array).forEach.call(dirImgBox.children,(v,i)=>{
              v.remove();
          });
          (new Array).forEach.call(dirFile.files, (v, i) => {
              var img = new Image();
              var div = document.createElement("div");
              img.src = window.URL.createObjectURL(v); //创建路径对象
              img.onload = function () {
                  div.style.width = imgWidth + "px";
                  div.style.height = Math.ceil(imgWidth / img.width * img.height) + "px";
                  if(imgLoadIndex < colspanCount){
                      imgHeightList.push(Math.ceil(imgWidth / img.width * img.height));
                      div.style.top = 0 + "px";
                      div.style.left = (imgWidth + 22) * imgLoadIndex + "px";
                      imgLoadIndex ++;
                  }else{
                      var minIndex = imgHeightList.indexOf(Math.min.apply(null,imgHeightList));
                      div.style.top = imgHeightList[minIndex] + 22 + "px";
                      div.style.left = (imgWidth + 22) * minIndex + "px";
                      imgHeightList[minIndex] +=  Math.ceil(imgWidth / img.width * img.height)  + 22;
                  }
                  img.width = 200;
                  dirImgBox.style.height = Math.max.apply(null,imgHeightList) + 22 + "px";
                  div.appendChild(img);
                  imgList.push(div)
                  dirImgBox.appendChild(div);
                  window.URL.revokeObjectURL(this.src); //删除路径对象
              }
          })

      }
      window.onresize = function(e){
          var changeColspanCount = parseInt(dirImgBox.offsetWidth/ (200 + 22));
          if(changeColspanCount != colspanCount){
              colspanCount = changeColspanCount;
              var imgHeightList = [];
              imgList.forEach((div,i)=>{
                  if(i < colspanCount){
                      imgHeightList.push(Math.ceil(div.offsetHeight));
                      div.style.top = 0 + "px";
                      div.style.left = (div.offsetWidth + 12) * i + "px";
                  }else{
                      var minIndex = imgHeightList.indexOf(Math.min.apply(null,imgHeightList));
                      div.style.top = imgHeightList[minIndex] + 12 + "px";
                      div.style.left = (div.offsetWidth + 12) * minIndex + "px";
                      imgHeightList[minIndex] +=  Math.ceil(div.offsetHeight)  + 12;
                  }
              })
              dirImgBox.style.height = Math.max.apply(null,imgHeightList) + 12 + "px";
          }
      }
  </script>
</body>
</html>